<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Ahab</title>

  <!-- PWA / Fullscreen Meta Tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ahab">
  <meta name="application-name" content="Ahab">
  <meta name="theme-color" content="#000000">
  <meta name="msapplication-navbutton-color" content="#000000">
  <meta name="msapplication-TileColor" content="#000000">

  <!-- Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Icons for iOS -->
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23000' width='100' height='100'/><text y='70' x='50' text-anchor='middle' font-size='60'>ðŸ”±</text></svg>">

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>
    @keyframes yumPop {
      0% { opacity: 0; transform: scale(0.5); }
      20% { opacity: 1; transform: scale(1.1); }
      40% { transform: scale(1); }
      100% { opacity: 0; transform: scale(1.2) translateY(-30px); }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }

    /* Tower of the Damned Animations */
    @keyframes screenShake {
      0%, 100% { transform: translateX(0); }
      10% { transform: translateX(-8px) translateY(2px); }
      20% { transform: translateX(8px) translateY(-2px); }
      30% { transform: translateX(-6px) translateY(1px); }
      40% { transform: translateX(6px) translateY(-1px); }
      50% { transform: translateX(-4px); }
      60% { transform: translateX(4px); }
      70% { transform: translateX(-2px); }
      80% { transform: translateX(2px); }
      90% { transform: translateX(-1px); }
    }
    @keyframes criticalFlash {
      0% { opacity: 0; }
      10% { opacity: 0.8; }
      100% { opacity: 0; }
    }
    @keyframes fragmentSlam {
      0% { transform: translateY(-100px) scale(1.5); opacity: 0; }
      60% { transform: translateY(10px) scale(1); opacity: 1; }
      80% { transform: translateY(-5px) scale(1); }
      100% { transform: translateY(0) scale(1); opacity: 1; }
    }
    @keyframes orbPulse {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.3); }
    }
    @keyframes fluidWave {
      0%, 100% { transform: translateY(0) scaleY(1); }
      50% { transform: translateY(-2px) scaleY(1.02); }
    }
    @keyframes spireGlow {
      0%, 100% { filter: drop-shadow(0 0 5px rgba(139, 0, 0, 0.5)); }
      50% { filter: drop-shadow(0 0 20px rgba(139, 0, 0, 0.8)) drop-shadow(0 0 40px rgba(70, 130, 180, 0.4)); }
    }
    @keyframes bossBreath {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.02); filter: brightness(1.2); }
    }
    .screen-shake { animation: screenShake 0.4s ease-out; }
    .critical-flash { animation: criticalFlash 0.3s ease-out; }
    .fragment-slam { animation: fragmentSlam 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
    .orb-pulse { animation: orbPulse 2s ease-in-out infinite; }
    .fluid-wave { animation: fluidWave 3s ease-in-out infinite; }
    .spire-glow { animation: spireGlow 3s ease-in-out infinite; }
    .boss-breath { animation: bossBreath 2s ease-in-out infinite; }

    /* Scroll of Penance Animations */
    @keyframes redSlash {
      0% { width: 0; opacity: 1; }
      50% { width: 100%; opacity: 1; }
      100% { width: 100%; opacity: 0.7; }
    }
    @keyframes jitter {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-3px) rotate(-0.5deg); }
      75% { transform: translateX(3px) rotate(0.5deg); }
    }
    @keyframes bloodDrip {
      0% { height: 0; opacity: 0; }
      10% { opacity: 1; }
      100% { height: 40px; opacity: 0; }
    }
    @keyframes soulFire {
      0%, 100% {
        box-shadow: 0 0 5px #4682b4, 0 0 10px #4682b4, 0 0 20px #4682b4;
        filter: brightness(1);
      }
      50% {
        box-shadow: 0 0 10px #4682b4, 0 0 20px #4682b4, 0 0 40px #4682b4, 0 0 60px #1e90ff;
        filter: brightness(1.3);
      }
    }
    @keyframes fragmentFly {
      0% {
        transform: translateX(-150px) translateY(100px) rotate(-45deg) scale(0.5);
        opacity: 0;
      }
      30% { opacity: 1; }
      70% {
        transform: translateX(0) translateY(-20px) rotate(10deg) scale(1.2);
      }
      100% {
        transform: translateX(0) translateY(0) rotate(0deg) scale(1);
        opacity: 1;
      }
    }
    @keyframes bossDefeat {
      0% { transform: scale(1); filter: brightness(1); }
      20% { transform: scale(1.1); filter: brightness(2) hue-rotate(30deg); }
      40% { transform: scale(0.9); filter: brightness(3) hue-rotate(60deg); }
      60% { transform: scale(1.2); filter: brightness(2) hue-rotate(90deg); }
      100% { transform: scale(0); filter: brightness(5); opacity: 0; }
    }
    @keyframes lootReveal {
      0% { transform: scale(0) rotate(-180deg); opacity: 0; }
      50% { transform: scale(1.2) rotate(10deg); opacity: 1; }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
    @keyframes healthDrain {
      from { width: var(--start-width); }
      to { width: var(--end-width); }
    }
    @keyframes parchmentBurn {
      0%, 100% { filter: sepia(0.3) brightness(0.9); }
      50% { filter: sepia(0.5) brightness(0.85); }
    }
    @keyframes curseBleed {
      0%, 100% { text-shadow: 0 0 0 transparent; }
      50% { text-shadow: 0 2px 4px #8b0000, 0 4px 8px rgba(139,0,0,0.5); }
    }
    .red-slash { animation: redSlash 0.3s ease-out forwards; }
    .jitter { animation: jitter 0.15s ease-in-out; }
    .blood-drip { animation: bloodDrip 2s ease-in infinite; }
    .soul-fire { animation: soulFire 1.5s ease-in-out infinite; }
    .fragment-fly { animation: fragmentFly 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
    .boss-defeat { animation: bossDefeat 1s ease-out forwards; }
    .loot-reveal { animation: lootReveal 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
    .parchment-burn { animation: parchmentBurn 4s ease-in-out infinite; }
    .curse-bleed { animation: curseBleed 2s ease-in-out infinite; }

    /* Knight Sprite Animations */
    /* Sprite sheet: 1758x1638, 17 cols x 16 rows, ~103x102 per frame */
    @keyframes knight-idle {
      from { background-position-x: 0%; }
      to { background-position-x: -1600%; }
    }
    @keyframes knight-walk {
      from { background-position-x: 0%; }
      to { background-position-x: -1600%; }
    }
    @keyframes knight-attack {
      from { background-position-x: 0%; }
      to { background-position-x: -1600%; }
    }
    @keyframes knight-victory {
      from { background-position-x: 0%; }
      to { background-position-x: -1600%; }
    }
    .knight-sprite {
      width: 120px;
      height: 120px;
      background-image: url('knight-sprite.png');
      background-size: 1700% 1600%;
      background-repeat: no-repeat;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
    .knight-idle {
      background-position-y: 0%;
      animation: knight-idle 1.2s steps(16) infinite;
    }
    .knight-walk {
      background-position-y: 6.67%;
      animation: knight-walk 0.8s steps(16) infinite;
    }
    .knight-attack {
      background-position-y: 20%;
      animation: knight-attack 0.6s steps(16) forwards;
    }
    .knight-heavy-attack {
      background-position-y: 26.67%;
      animation: knight-attack 0.8s steps(16) forwards;
    }
    .knight-victory {
      background-position-y: 60%;
      animation: knight-victory 1s steps(16) forwards;
    }
    .knight-death {
      background-position-y: 86.67%;
      animation: knight-attack 1.2s steps(16) forwards;
    }

    /* Scroll texture */
    .scroll-texture {
      background:
        linear-gradient(135deg, rgba(139,69,19,0.1) 0%, transparent 50%),
        linear-gradient(225deg, rgba(139,69,19,0.1) 0%, transparent 50%),
        radial-gradient(ellipse at center, #1a1510 0%, #0d0a08 100%);
      border: 2px solid #3d2914;
      box-shadow:
        inset 0 0 30px rgba(0,0,0,0.8),
        0 0 10px rgba(0,0,0,0.5);
    }
    .burnt-edge {
      clip-path: polygon(
        0% 5%, 3% 0%, 8% 3%, 15% 0%, 22% 4%, 30% 1%, 38% 3%, 45% 0%,
        52% 4%, 60% 1%, 68% 3%, 75% 0%, 82% 4%, 90% 1%, 95% 3%, 100% 0%,
        100% 95%, 97% 100%, 92% 97%, 85% 100%, 78% 96%, 70% 99%, 62% 97%, 55% 100%,
        48% 96%, 40% 99%, 32% 97%, 25% 100%, 18% 96%, 10% 99%, 5% 97%, 0% 100%
      );
    }

    /* Safe area for iOS notch */
    html, body {
      overflow-x: hidden;
      max-width: 100vw;
    }
    body {
      padding-top: env(safe-area-inset-top);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
    }
    .safe-area-bottom {
      padding-bottom: env(safe-area-inset-bottom);
    }
  </style>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Supabase setup
    const supabaseUrl = 'https://afrtysreyedlamquttig.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFmcnR5c3JleWVkbGFtcXV0dGlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwMzMxNzUsImV4cCI6MjA4MzYwOTE3NX0.hy_XzmTi66DUzW1Qp_14e36AzbtnmWvlL2uC9c3-BxA';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    // ============================================
    // CONSTANTS - Defined outside component to prevent recreation on each render
    // ============================================

    // Weight tracking constants
    const START_WEIGHT = 233;
    const GOAL_WEIGHT = 190;
    const WEIGHT_TO_LOSE = START_WEIGHT - GOAL_WEIGHT; // 43 lbs
    const TARGET_DATE = '2026-09-01';
    const WEIGHT_START_DATE = '2025-01-01';

    // Validation constants
    const MIN_VALID_WEIGHT = 50;
    const MAX_VALID_WEIGHT = 500;

    // XP rewards
    const XP_PER_MEAL = 10;
    const XP_PER_TRAINING = 20;
    const XP_PER_HYDRATION = 5;

    // Rank progression system
    const RANKS = [
      { level: 10, name: 'HOLLOW', icon: 'ðŸ’€', xpRequired: 0 },
      { level: 9, name: 'REVENANT', icon: 'âš”ï¸', xpRequired: 100 },
      { level: 8, name: 'SLAYER', icon: 'ðŸ›¡ï¸', xpRequired: 200 },
      { level: 7, name: 'OVERLORD', icon: 'ðŸ‘¹', xpRequired: 300 },
      { level: 6, name: 'APEX', icon: 'âš¡', xpRequired: 400 },
      { level: 5, name: 'MYTHIC', icon: 'ðŸ”®', xpRequired: 500 },
      { level: 4, name: 'EXALTED', icon: 'ðŸ‘‘', xpRequired: 600 },
      { level: 3, name: 'DEMIGOD', icon: 'ðŸŒŸ', xpRequired: 700 },
      { level: 2, name: 'ASCENDANT', icon: 'âœ¨', xpRequired: 800 },
      { level: 1, name: 'APOTHEOSIS', icon: 'ðŸ†', xpRequired: 900 }
    ];

    // Meal plan
    const MEALS = [
      { id: 'meal1', name: 'Breakfast', calories: 700, items: ['4 whole eggs', '200g oatmeal', '1 banana', '100g berries'], macros: '42g protein Â· 70g carbs Â· 28g fat' },
      { id: 'meal2', name: 'Lunch', calories: 700, items: ['200g chicken breast', '200g rice', '150g broccoli', '1 tbsp olive oil'], macros: '62g protein Â· 55g carbs Â· 16g fat' },
      { id: 'meal3', name: 'Dinner', calories: 700, items: ['200g beef', '300g sweet potato', '200g vegetables', '200g yogurt'], macros: '96g protein Â· 55g carbs Â· 16g fat' }
    ];

    // Grocery lists
    const GROCERY_BULK = ['Oats (large container)', 'Rice (5-10 lb bag)', 'Sweet potatoes (10 lb)', 'Olive oil', 'Seasonings & spices'];
    const GROCERY_WEEKLY = ['Eggs (2 dozen)', 'Chicken breast (3 lbs)', 'Beef (3 lbs)', 'Bananas (7-8)', 'Mixed berries (700g)', 'Broccoli (2 lbs)', 'Mixed vegetables (3 lbs)', 'Greek yogurt (1400g)'];

    // Workout routines
    const WORKOUTS = {
      push: { name: 'Push', exercises: [
        { name: 'Overhead Shoulder Press', target: '4x8-10' },
        { name: 'Incline Dumbbell Bench', target: '4x8-10' },
        { name: 'Lateral Raises', target: '3x12-15' },
        { name: 'Overhead Tricep Extension', target: '3x10-12' }
      ]},
      pull: { name: 'Pull', exercises: [
        { name: 'Pull-ups', target: '4x8-10' },
        { name: 'Barbell Rows', target: '4x8-10' },
        { name: 'Face Pulls', target: '3x12-15' },
        { name: 'Bicep Curls', target: '3x10-12' }
      ]},
      legs: { name: 'Legs', exercises: [
        { name: 'Deadlift', target: '4x6-8' },
        { name: 'Leg Press', target: '4x10-12' },
        { name: 'Bulgarian Split Squats', target: '3x10-12' },
        { name: 'Leg Curls', target: '3x12-15' }
      ]}
    };


    // ============================================
    // UTILITY FUNCTIONS
    // ============================================

    // Validate weight input
    const validateWeight = (value) => {
      const num = parseFloat(value);
      if (isNaN(num)) return { valid: false, value: null };
      if (num < MIN_VALID_WEIGHT || num > MAX_VALID_WEIGHT) return { valid: false, value: null };
      return { valid: true, value: num };
    };

    // Separate Clock component to avoid re-rendering entire app every second
    const Clock = () => {
      const [time, setTime] = useState(new Date());
      useEffect(() => {
        const interval = setInterval(() => setTime(new Date()), 1000);
        return () => clearInterval(interval);
      }, []);
      return (
        <span>{time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true }).replace(' ', '')}</span>
      );
    };

    // Separate Countdown component
    const Countdown = () => {
      const [days, setDays] = useState(Math.max(0, Math.ceil((new Date('2026-09-01') - new Date()) / (1000 * 60 * 60 * 24))));
      useEffect(() => {
        const interval = setInterval(() => {
          setDays(Math.max(0, Math.ceil((new Date('2026-09-01') - new Date()) / (1000 * 60 * 60 * 24))));
        }, 60000); // Update every minute is fine for day countdown
        return () => clearInterval(interval);
      }, []);
      return <span className="text-red-400 text-lg">{days}</span>;
    };

    // Weight Graph Component
    const WeightGraph = ({ history, startWeight = START_WEIGHT, goalWeight = GOAL_WEIGHT }) => {
      if (!history || history.length < 1) {
        return (
          <div className="text-center py-6 text-neutral-600 text-sm">
            Log your weight above to start tracking
          </div>
        );
      }

      const width = 300;
      const height = 150;
      const padding = { top: 25, right: 20, bottom: 25, left: 40 };
      const graphWidth = width - padding.left - padding.right;
      const graphHeight = height - padding.top - padding.bottom;

      // Get min/max for scale
      const weights = history.map(h => h.weight);
      const minWeight = Math.min(goalWeight, ...weights) - 5;
      const maxWeight = Math.max(startWeight, ...weights) + 5;
      const weightRange = maxWeight - minWeight || 1; // Prevent division by zero

      // Calculate positions
      const points = history.map((h, i) => ({
        x: padding.left + (history.length === 1 ? graphWidth / 2 : (i / (history.length - 1)) * graphWidth),
        y: padding.top + ((maxWeight - h.weight) / weightRange) * graphHeight,
        weight: h.weight,
        date: h.date
      }));

      // Create path
      const linePath = points.length > 1
        ? points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ')
        : '';

      // Goal line Y position
      const goalY = padding.top + ((maxWeight - goalWeight) / weightRange) * graphHeight;
      const startY = padding.top + ((maxWeight - startWeight) / weightRange) * graphHeight;

      return (
        <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-auto" style={{minHeight: '120px'}}>
          {/* Grid lines */}
          {[0, 0.5, 1].map((pct, i) => (
            <line key={i} x1={padding.left} y1={padding.top + pct * graphHeight} x2={width - padding.right} y2={padding.top + pct * graphHeight} stroke="#1f1f1f" strokeWidth="1" />
          ))}

          {/* Start weight line */}
          <line x1={padding.left} y1={startY} x2={width - padding.right} y2={startY} stroke="#ef4444" strokeWidth="1" strokeDasharray="4,4" opacity="0.5" />
          <text x={padding.left - 5} y={startY + 4} textAnchor="end" fill="#ef4444" fontSize="10">{startWeight}</text>

          {/* Goal line */}
          <line x1={padding.left} y1={goalY} x2={width - padding.right} y2={goalY} stroke="#22c55e" strokeWidth="1" strokeDasharray="4,4" />
          <text x={padding.left - 5} y={goalY + 4} textAnchor="end" fill="#22c55e" fontSize="10">{goalWeight}</text>

          {/* Weight line - only draw if more than 1 point */}
          {points.length > 1 && (
            <path d={linePath} fill="none" stroke="#ef4444" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" />
          )}

          {/* Data points - larger for mobile */}
          {points.map((p, i) => (
            <g key={i}>
              <circle cx={p.x} cy={p.y} r="6" fill="#ef4444" stroke="#000" strokeWidth="2" />
              <text x={p.x} y={p.y - 10} textAnchor="middle" fill="#fff" fontSize="11" fontWeight="bold">{p.weight}</text>
            </g>
          ))}

          {/* X-axis labels - first and last date */}
          {history.length > 0 && (
            <>
              <text x={padding.left} y={height - 5} textAnchor="start" fill="#666" fontSize="9">{history[0].date.slice(5)}</text>
              {history.length > 1 && (
                <text x={width - padding.right} y={height - 5} textAnchor="end" fill="#666" fontSize="9">{history[history.length - 1].date.slice(5)}</text>
              )}
            </>
          )}
        </svg>
      );
    };

    // Isolated input component - manages own state while typing, syncs on blur
    const DebouncedInput = ({ value, onSave, placeholder, className, inputMode = 'text', pattern }) => {
      const [localValue, setLocalValue] = useState(value || '');
      const initialValueRef = useRef(value);

      // Only sync from parent if the parent's value actually changed (not from our own save)
      useEffect(() => {
        if (value !== initialValueRef.current) {
          setLocalValue(value || '');
          initialValueRef.current = value;
        }
      }, [value]);

      return (
        <input
          type="text"
          inputMode={inputMode}
          pattern={pattern}
          placeholder={placeholder}
          value={localValue}
          onChange={(e) => setLocalValue(e.target.value)}
          onBlur={() => {
            onSave(localValue);
            initialValueRef.current = localValue;
          }}
          className={className}
        />
      );
    };

    const AhabApp = () => {
      // ============================================
      // STATE - Grouped by feature area
      // ============================================

      // Navigation & UI
      const [currentView, setCurrentView] = useState('home');
      const [showYum, setShowYum] = useState(false);
      const [showLogged, setShowLogged] = useState(false);
      const [dayComplete, setDayComplete] = useState(false);
      const [showSyncModal, setShowSyncModal] = useState(false);

      // Day tracking
      const [weekData, setWeekData] = useState({});
      const [selectedLogDay, setSelectedLogDay] = useState(null); // null = today
      const [loggedDays, setLoggedDays] = useState({}); // tracks which days have been logged

      // Weight tracking
      const [currentWeight, setCurrentWeight] = useState(String(START_WEIGHT));
      const [weightHistory, setWeightHistory] = useState([]);

      // Workouts & PRs
      const [workoutLog, setWorkoutLog] = useState({});
      const [selectedWorkout, setSelectedWorkout] = useState('push');
      const [workoutDate, setWorkoutDate] = useState(new Date().toISOString().split('T')[0]);
      const [personalRecords, setPersonalRecords] = useState({
        bench: { weight: '', reps: '', date: '' },
        squat: { weight: '', reps: '', date: '' },
        deadlift: { weight: '', reps: '', date: '' },
        ohp: { weight: '', reps: '', date: '' },
        pullups: { weight: '', reps: '', date: '' }
      });

      // Progression & XP
      const [xp, setXp] = useState(0);

      // Food & Grocery
      const [groceryChecked, setGroceryChecked] = useState({});

      // Cloud sync
      const [syncCode, setSyncCode] = useState(() => localStorage.getItem('syncCode') || '');
      const [syncStatus, setSyncStatus] = useState('');
      const [isSyncing, setIsSyncing] = useState(false);
      const syncTimeoutRef = useRef(null);

      // Calendar
      const [calendarMonth, setCalendarMonth] = useState(new Date());
      const [calendarDayDetail, setCalendarDayDetail] = useState(null);
      const [longPressTimer, setLongPressTimer] = useState(null);

      // Tower of the Damned
      const [showCriticalHit, setShowCriticalHit] = useState(false);
      const [towerShake, setTowerShake] = useState(false);
      const [lastFragment, setLastFragment] = useState(null);
      const [slashedEdict, setSlashedEdict] = useState(null);
      const [flyingFragment, setFlyingFragment] = useState(false);
      const [bossDefeated, setBossDefeated] = useState(false);
      const [showLoot, setShowLoot] = useState(false);
      const [earnedBadges, setEarnedBadges] = useState(() => {
        const saved = localStorage.getItem('earnedBadges');
        return saved ? JSON.parse(saved) : [];
      });

      // Knight animation state
      const [knightAction, setKnightAction] = useState('idle');
      const knightActionTimeoutRef = useRef(null);

      // Save data to Supabase
      const saveToCloud = async (code, data) => {
        if (!code) return;
        try {
          const { error } = await supabase
            .from('sync_data')
            .upsert({
              sync_code: code,
              data: data,
              updated_at: new Date().toISOString()
            });
          if (error) throw error;
          return true;
        } catch (e) {
          console.error('Sync save error:', e);
          return false;
        }
      };

      // Load data from Supabase
      const loadFromCloud = async (code) => {
        if (!code) return null;
        try {
          const { data, error } = await supabase
            .from('sync_data')
            .select('data')
            .eq('sync_code', code)
            .single();
          if (error && error.code !== 'PGRST116') throw error;
          return data?.data || null;
        } catch (e) {
          console.error('Sync load error:', e);
          return null;
        }
      };

      // Apply cloud data to local state and localStorage
      const applyCloudData = (cloudData) => {
        if (!cloudData) return;
        if (cloudData.weekData) { setWeekData(cloudData.weekData); localStorage.setItem('weekData', JSON.stringify(cloudData.weekData)); }
        if (cloudData.currentWeight) { setCurrentWeight(cloudData.currentWeight); localStorage.setItem('currentWeight', cloudData.currentWeight); }
        if (cloudData.weightHistory) {
          // Filter out any artificial starting points from cloud data
          const filtered = cloudData.weightHistory.filter(h => h.date !== WEIGHT_START_DATE);
          setWeightHistory(filtered);
          localStorage.setItem('weightHistory', JSON.stringify(filtered));
        }
        if (cloudData.workoutLog) { setWorkoutLog(cloudData.workoutLog); localStorage.setItem('workouts', JSON.stringify(cloudData.workoutLog)); }
        if (cloudData.personalRecords) { setPersonalRecords(cloudData.personalRecords); localStorage.setItem('personalRecords', JSON.stringify(cloudData.personalRecords)); }
        if (typeof cloudData.xp === 'number') { setXp(cloudData.xp); localStorage.setItem('xp', cloudData.xp.toString()); }
        if (cloudData.groceryChecked) { setGroceryChecked(cloudData.groceryChecked); localStorage.setItem('grocery', JSON.stringify(cloudData.groceryChecked)); }
      };

      // Debounced sync - waits 2 seconds after last change before syncing
      const triggerSync = () => {
        if (!syncCode) return;
        if (syncTimeoutRef.current) clearTimeout(syncTimeoutRef.current);
        syncTimeoutRef.current = setTimeout(async () => {
          setIsSyncing(true);
          const allData = {
            weekData,
            currentWeight,
            weightHistory,
            workoutLog,
            personalRecords,
            xp,
            groceryChecked
          };
          await saveToCloud(syncCode, allData);
          setIsSyncing(false);
        }, 2000);
      };

      // Connect with sync code
      const connectSync = async () => {
        if (!syncCode.trim()) {
          setSyncStatus('Enter a sync code');
          return;
        }
        const code = syncCode.trim().toLowerCase();
        setSyncCode(code);
        localStorage.setItem('syncCode', code);
        setIsSyncing(true);
        setSyncStatus('Connecting...');

        // Try to load existing data
        const cloudData = await loadFromCloud(code);

        if (cloudData) {
          // Data exists - load it
          applyCloudData(cloudData);
          setSyncStatus('Synced! Data loaded.');
        } else {
          // No data exists - save current data
          const allData = { weekData, currentWeight, weightHistory, workoutLog, personalRecords, xp, groceryChecked };
          await saveToCloud(code, allData);
          setSyncStatus('Synced! Code created.');
        }
        setIsSyncing(false);
      };

      // Disconnect sync
      const disconnectSync = () => {
        setSyncCode('');
        localStorage.removeItem('syncCode');
        setSyncStatus('Disconnected');
      };

      // Reactor Switch Component
      const ReactorSwitch = ({ engaged, onToggle, label, color = 'red' }) => {
        const colors = {
          red: { bg: 'bg-red-700', text: 'text-red-400' },
          orange: { bg: 'bg-orange-700', text: 'text-orange-400' },
          blue: { bg: 'bg-blue-700', text: 'text-blue-400' }
        };
        const c = colors[color];
        return (
          <button onClick={onToggle} className={`relative w-full h-12 rounded-lg overflow-hidden transition-all duration-200 ${engaged ? c.bg : 'bg-neutral-900 border border-neutral-800'}`}>
            <div className={`absolute inset-0 flex items-center justify-between px-4`}>
              <span className={`text-sm font-medium ${engaged ? 'text-white' : c.text}`}>{label}</span>
              <div className={`w-12 h-6 rounded-full ${engaged ? 'bg-black/30' : 'bg-neutral-800'} flex items-center p-1 transition-all`}>
                <div className={`w-4 h-4 rounded-full transition-all duration-200 ${engaged ? 'bg-white ml-auto' : 'bg-neutral-600'}`} />
              </div>
            </div>
          </button>
        );
      };

      const getCurrentRank = () => {
        for (let i = RANKS.length - 1; i >= 0; i--) {
          if (xp >= RANKS[i].xpRequired) return RANKS[i];
        }
        return RANKS[0];
      };

      const getNextRank = () => {
        const current = getCurrentRank();
        const idx = RANKS.findIndex(r => r.level === current.level);
        return idx < RANKS.length - 1 ? RANKS[idx + 1] : null;
      };

      const getXpProgress = () => {
        const current = getCurrentRank();
        const next = getNextRank();
        if (!next) return 100;
        const xpIntoLevel = xp - current.xpRequired;
        const xpNeeded = next.xpRequired - current.xpRequired;
        return (xpIntoLevel / xpNeeded) * 100;
      };

      const logProgress = (dayToLog) => {
        const day = dayToLog || getTodayString();
        localStorage.setItem('weekData', JSON.stringify(weekData));
        localStorage.setItem('currentWeight', currentWeight);
        localStorage.setItem('grocery', JSON.stringify(groceryChecked));
        localStorage.setItem('workouts', JSON.stringify(workoutLog));

        // Award XP: 10 per meal, 20 for training, 5 for water (8 glasses) - only for today
        if (day === getTodayString()) {
          const td = weekData[day] || {};
          const todayKey = `xp_awarded_${day}`;
          if (!localStorage.getItem(todayKey)) {
            let earnedXp = 0;
            if (td.meal1) earnedXp += 10;
            if (td.meal2) earnedXp += 10;
            if (td.meal3) earnedXp += 10;
            if (td.training) earnedXp += 20;
            if ((td.water || 0) >= 8) earnedXp += 5;
            if (earnedXp > 0) {
              const newXp = xp + earnedXp;
              setXp(newXp);
              localStorage.setItem('xp', newXp.toString());
              localStorage.setItem(todayKey, 'true');
            }
          }
        }

        // Mark this day as logged (hides LOG IT button)
        setLoggedDays(prev => ({ ...prev, [day]: true }));

        setShowLogged(true);
        setTimeout(() => setShowLogged(false), 1500);
        // If all tasks done, mark day as complete to hide the bar
        const td = weekData[day] || {};
        if (td.meal1 && td.meal2 && td.meal3 && td.training) {
          setDayComplete(true);
        }
      };

      const triggerYum = () => { setShowYum(true); setTimeout(() => setShowYum(false), 1000); };

      // Helper to get current week's dates (Monday-Sunday)
      const getCurrentWeekDates = () => {
        const today = new Date();
        const dayOfWeek = today.getDay(); // 0 = Sunday
        const monday = new Date(today);
        monday.setDate(today.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));

        const dates = [];
        for (let i = 0; i < 7; i++) {
          const d = new Date(monday);
          d.setDate(monday.getDate() + i);
          dates.push(d.toISOString().split('T')[0]);
        }
        return dates;
      };

      // Format date for display (e.g., "Mon 1/13")
      const formatDateShort = (dateStr) => {
        const d = new Date(dateStr + 'T00:00:00');
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        return `${days[d.getDay()]} ${d.getMonth() + 1}/${d.getDate()}`;
      };

      // Get day name from date
      const getDayName = (dateStr) => {
        const d = new Date(dateStr + 'T00:00:00');
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        return days[d.getDay()];
      };

      const getTodayString = () => {
        return new Date().toISOString().split('T')[0];
      };



      // Progressive reward themes based on rank
      const getThemeColors = () => {
        const rank = getCurrentRank();
        if (rank.level <= 3) return { accent: 'from-yellow-500 to-amber-400', text: 'text-yellow-400', name: 'OBSIDIAN GOLD' }; // Demigod+
        if (rank.level <= 5) return { accent: 'from-purple-500 to-pink-500', text: 'text-purple-400', name: 'VOID PURPLE' }; // Mythic+
        if (rank.level <= 7) return { accent: 'from-cyan-500 to-blue-500', text: 'text-cyan-400', name: 'FROST BLUE' }; // Overlord+
        return { accent: 'from-red-600 to-red-500', text: 'text-red-400', name: 'BLOOD RED' }; // Default
      };
      const theme = getThemeColors();

      useEffect(() => {
        const saved = localStorage.getItem('weekData');
        if (saved) setWeekData(JSON.parse(saved));
        // No need to pre-initialize - entries are created on demand by date
        const w = localStorage.getItem('currentWeight'); if (w) setCurrentWeight(w);
        const g = localStorage.getItem('grocery'); if (g) setGroceryChecked(JSON.parse(g));
        const wl = localStorage.getItem('workouts'); if (wl) setWorkoutLog(JSON.parse(wl));
        const savedXp = localStorage.getItem('xp'); if (savedXp) setXp(parseInt(savedXp));
        const savedPRs = localStorage.getItem('personalRecords'); if (savedPRs) setPersonalRecords(JSON.parse(savedPRs));
        const savedWeightHistory = localStorage.getItem('weightHistory');
        if (savedWeightHistory) {
          const parsed = JSON.parse(savedWeightHistory);
          // Filter out any old artificial starting points
          const filtered = parsed.filter(h => h.date !== WEIGHT_START_DATE);
          setWeightHistory(filtered);
          if (filtered.length !== parsed.length) {
            localStorage.setItem('weightHistory', JSON.stringify(filtered));
          }
        }
        // Auto-load from cloud if sync code exists
        const savedSyncCode = localStorage.getItem('syncCode');
        if (savedSyncCode) {
          setIsSyncing(true);
          loadFromCloud(savedSyncCode).then(cloudData => {
            applyCloudData(cloudData);
          }).finally(() => {
            setIsSyncing(false);
          });
        }
      }, []);

      const toggleMeal = (day, meal) => {
        const dayData = weekData[day] || {};
        const wasChecked = dayData[meal];
        const newData = { ...weekData, [day]: { ...dayData, [meal]: !dayData[meal] } };
        setWeekData(newData); localStorage.setItem('weekData', JSON.stringify(newData));
        // Reset dayComplete if unchecking on today
        if (day === getTodayString()) setDayComplete(false);
        // Mark day as needing to be logged
        setLoggedDays(prev => ({ ...prev, [day]: false }));
        // Trigger critical hit on task completion (not unchecking)
        if (!wasChecked) {
          triggerCriticalHit(meal);
        }
        triggerSync();
      };

      const saveWeight = (day, wt) => {
        // day is now a date string (YYYY-MM-DD)
        const newData = { ...weekData, [day]: { ...weekData[day], weight: wt } };
        setWeekData(newData);
        localStorage.setItem('weekData', JSON.stringify(newData));
        // Mark day as needing to be logged
        setLoggedDays(prev => ({ ...prev, [day]: false }));
        if (wt) {
          // Validate weight before saving
          const validation = validateWeight(wt);
          if (!validation.valid) {
            return; // Don't save invalid weights
          }

          setCurrentWeight(wt);
          localStorage.setItem('currentWeight', wt);

          setWeightHistory(prev => {
            // Filter out this date's previous entry, then add new one
            const filtered = prev.filter(h => h.date !== day);
            const updated = [...filtered, { date: day, weight: validation.value }].sort((a, b) => a.date.localeCompare(b.date));
            localStorage.setItem('weightHistory', JSON.stringify(updated));
            return updated;
          });
        }
        triggerSync();
      };

      const updateWater = (day, amt) => {
        const prevAmt = weekData[day]?.water || 0;
        const newData = { ...weekData, [day]: { ...weekData[day], water: amt } };
        setWeekData(newData); localStorage.setItem('weekData', JSON.stringify(newData));
        // Mark day as needing to be logged
        setLoggedDays(prev => ({ ...prev, [day]: false }));
        // Trigger critical hit when reaching 8 glasses
        if (amt >= 8 && prevAmt < 8) {
          triggerCriticalHit('water');
        }
        triggerSync();
      };

      const toggleGrocery = (item) => {
        const newChecked = { ...groceryChecked, [item]: !groceryChecked[item] };
        setGroceryChecked(newChecked); localStorage.setItem('grocery', JSON.stringify(newChecked));
        triggerSync();
      };

      const updateExerciseLog = (date, workoutType, exercise, field, value) => {
        const newLog = { ...workoutLog };
        if (!newLog[date]) newLog[date] = {};
        if (!newLog[date][workoutType]) newLog[date][workoutType] = {};
        if (!newLog[date][workoutType][exercise]) newLog[date][workoutType][exercise] = { weight: '', reps: '', sets: '' };
        newLog[date][workoutType][exercise][field] = value;
        setWorkoutLog(newLog); localStorage.setItem('workouts', JSON.stringify(newLog));
        triggerSync();
      };

      const getExerciseData = (date, workoutType, exercise) => workoutLog[date]?.[workoutType]?.[exercise] || { weight: '', reps: '', sets: '' };

      const getCalendarDays = () => {
        const year = calendarMonth.getFullYear();
        const month = calendarMonth.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startPadding = firstDay.getDay();
        const days = [];

        for (let i = 0; i < startPadding; i++) days.push(null);
        for (let i = 1; i <= daysInMonth; i++) days.push(i);
        return days;
      };

      const getDayStatus = (day) => {
        if (!day) return 'empty';
        const year = calendarMonth.getFullYear();
        const month = calendarMonth.getMonth();
        const dateObj = new Date(year, month, day);
        const todayDate = new Date();
        todayDate.setHours(0,0,0,0);

        if (dateObj > todayDate) return 'future';

        // Look up by actual date string (YYYY-MM-DD)
        const dateStr = dateObj.toISOString().split('T')[0];
        const data = weekData[dateStr] || {};

        const meals = (data.meal1 ? 1 : 0) + (data.meal2 ? 1 : 0) + (data.meal3 ? 1 : 0);
        const training = data.training ? 1 : 0;

        if (meals === 3 && training === 1) return 'perfect';
        if (meals > 0 || training > 0) return 'partial';
        return 'missed';
      };

      const getWorkoutHistory = (workoutType, exercise) => {
        const history = [];
        Object.keys(workoutLog).sort().reverse().forEach(date => {
          if (workoutLog[date]?.[workoutType]?.[exercise]) {
            const data = workoutLog[date][workoutType][exercise];
            if (data.weight || data.reps || data.sets) history.push({ date, ...data });
          }
        });
        return history.slice(0, 5);
      };

      // Get PR (max weight) for an exercise from workout history
      const getExercisePR = (workoutType, exerciseName) => {
        let maxWeight = 0;
        let prData = null;
        Object.keys(workoutLog).forEach(date => {
          const data = workoutLog[date]?.[workoutType]?.[exerciseName];
          if (data && data.weight) {
            const weight = parseFloat(data.weight);
            if (weight > maxWeight) {
              maxWeight = weight;
              prData = { weight: data.weight, reps: data.reps, sets: data.sets, date };
            }
          }
        });
        return prData;
      };


      const getTimeGreeting = () => {
        const hour = new Date().getHours();
        if (hour < 12) return 'GOOD MORNING';
        if (hour < 17) return 'GOOD AFTERNOON';
        if (hour < 21) return 'GOOD EVENING';
        return 'LATE NIGHT GRIND';
      };

      const getWeeklyStats = () => {
        let mealsHit = 0, totalMeals = 0, workoutsHit = 0, waterTotal = 0;
        const weekDates = getCurrentWeekDates();
        weekDates.forEach(d => {
          if (weekData[d]) {
            if (weekData[d].meal1) mealsHit++; if (weekData[d].meal2) mealsHit++; if (weekData[d].meal3) mealsHit++;
            totalMeals += 3; if (weekData[d].training) workoutsHit++; waterTotal += weekData[d].water || 0;
          } else {
            totalMeals += 3; // Still count as potential meals
          }
        });
        return { mealsHit, workoutsHit, consistency: totalMeals > 0 ? Math.round((mealsHit / totalMeals) * 100) : 0, waterTotal };
      };

      const getLastWeekStats = () => {
        // Get last week's dates
        const today = new Date();
        const lastWeekDates = [];
        for (let i = 7; i <= 13; i++) {
          const d = new Date(today);
          d.setDate(today.getDate() - i);
          lastWeekDates.push(d.toISOString().split('T')[0]);
        }

        let mealsHit = 0, workoutsHit = 0;
        lastWeekDates.forEach(dateStr => {
          const data = weekData[dateStr];
          if (data) {
            if (data.meal1) mealsHit++;
            if (data.meal2) mealsHit++;
            if (data.meal3) mealsHit++;
            if (data.training) workoutsHit++;
          }
        });
        return { mealsHit, workoutsHit, consistency: Math.round((mealsHit / 21) * 100) };
      };

      const getStreak = () => {
        let streak = 0;
        const today = new Date();
        // Count backwards from today
        for (let i = 0; i < 365; i++) { // Check up to a year back
          const checkDate = new Date(today);
          checkDate.setDate(today.getDate() - i);
          const dateStr = checkDate.toISOString().split('T')[0];
          const data = weekData[dateStr];
          if (data && (data.meal1 || data.meal2 || data.meal3 || data.training)) {
            streak++;
          } else if (i > 0) { // Allow today to be incomplete
            break;
          }
        }
        return streak;
      };

      const getNextWorkout = () => {
        const rotation = ['push', 'pull', 'legs'];
        const lastWorkouts = [];
        Object.keys(workoutLog).sort().reverse().slice(0, 3).forEach(date => {
          Object.keys(workoutLog[date] || {}).forEach(wType => { if (!lastWorkouts.includes(wType)) lastWorkouts.push(wType); });
        });
        if (lastWorkouts.length === 0) return 'push';
        const lastIdx = rotation.indexOf(lastWorkouts[0]);
        return rotation[(lastIdx + 1) % 3];
      };

      // ============================================
      // TOWER OF THE DAMNED
      // ============================================

      // Calculate tower level (weeks of activity)
      const getTowerLevel = () => {
        const startDate = new Date('2025-01-01');
        const now = new Date();
        const weeksSinceStart = Math.floor((now - startDate) / (7 * 24 * 60 * 60 * 1000));
        return Math.max(1, weeksSinceStart + 1);
      };

      // Calculate daily edicts completed (tasks done today)
      const getDailyEdicts = (dateStr) => {
        const data = weekData[dateStr] || {};
        let count = 0;
        if (data.meal1) count++;
        if (data.meal2) count++;
        if (data.meal3) count++;
        if (data.training) count++;
        if ((data.water || 0) >= 8) count++;
        return count;
      };

      // Calculate weekly completion for current week (0-5 scale for fragments)
      const getWeeklyFragments = () => {
        const weekDates = getCurrentWeekDates();
        let daysCompleted = 0;
        weekDates.forEach(dateStr => {
          const edicts = getDailyEdicts(dateStr);
          if (edicts >= 3) daysCompleted++; // 3+ edicts = day counts
        });
        return Math.min(5, daysCompleted);
      };

      // Check if we're in boss week (every 4 weeks)
      const isBossWeek = () => getTowerLevel() % 4 === 0;

      // Get boss name for current stage
      const getBossName = () => {
        const stage = Math.floor(getTowerLevel() / 4);
        const bosses = [
          { name: 'Malphas, The Unyielding Burden', icon: 'ðŸ‘¹' },
          { name: 'Verath, Devourer of Will', icon: 'ðŸ‰' },
          { name: 'Nethys, The Hollow Promise', icon: 'ðŸ’€' },
          { name: 'Kharos, Lord of Stagnation', icon: 'âš”ï¸' },
          { name: 'Morvain, The Final Doubt', icon: 'ðŸ‘‘' }
        ];
        return bosses[stage % bosses.length];
      };

      // Get day of week (1-7, Monday = 1)
      const getDayOfWeek = () => {
        const day = new Date().getDay();
        return day === 0 ? 7 : day;
      };

      // Check if in Sabbath (day 6 or 7 with 5+ fragments)
      const isSabbath = () => getDayOfWeek() >= 6 && getWeeklyFragments() >= 5;

      // Trigger critical hit effect with enhanced animations
      const triggerCriticalHit = (edictKey) => {
        // Knight attack animation
        const isHeavy = edictKey === 'training';
        triggerKnightAttack(isHeavy ? 'heavy-attack' : 'attack');

        // Slash animation on the edict
        setSlashedEdict(edictKey);
        setTimeout(() => setSlashedEdict(null), 500);

        // Flying fragment animation
        setFlyingFragment(true);
        setTimeout(() => setFlyingFragment(false), 600);

        // Screen shake and flash
        setShowCriticalHit(true);
        setTowerShake(true);
        setLastFragment(edictKey);
        setTimeout(() => setShowCriticalHit(false), 300);
        setTimeout(() => setTowerShake(false), 400);

        // Check for boss defeat (all 5 edicts done in boss week)
        setTimeout(() => {
          if (isBossWeek()) {
            const todayStr = getTodayString();
            const td = weekData[todayStr] || {};
            const allDone = td.meal1 && td.meal2 && td.meal3 && td.training && (td.water || 0) >= 8;
            if (allDone && !bossDefeated) {
              setBossDefeated(true);
              // Knight victory animation
              setKnightAction('victory');
              setTimeout(() => {
                setShowLoot(true);
                // Award badge
                const newBadge = { name: getBossName().name, date: todayStr, icon: 'ðŸ†' };
                const updated = [...earnedBadges, newBadge];
                setEarnedBadges(updated);
                localStorage.setItem('earnedBadges', JSON.stringify(updated));
              }, 1000);
            }
          }
        }, 500);
      };

      // Loot badges
      const LOOT_BADGES = [
        { id: 'iron_heart', name: 'The Iron Heart', icon: 'ðŸ–¤', desc: 'Defeated Malphas' },
        { id: 'void_crown', name: 'The Void Crown', icon: 'ðŸ‘‘', desc: 'Defeated Verath' },
        { id: 'soul_chain', name: 'The Soul Chain', icon: 'â›“ï¸', desc: 'Defeated Nethys' },
        { id: 'blood_sigil', name: 'The Blood Sigil', icon: 'ðŸ©¸', desc: 'Defeated Kharos' },
        { id: 'doom_rune', name: 'The Doom Rune', icon: 'ðŸ”®', desc: 'Defeated Morvain' }
      ];

      // Knight Sprite Component
      // Sprite sheet: 1758x1638px, 17 cols x 16 rows
      // Row mapping: 0=idle, 1-2=walk, 3-4=attack, 9-10=heavy, 13=victory
      const KnightSprite = ({ action = 'idle', size = 120 }) => {
        const getAnimationClass = () => {
          switch(action) {
            case 'walk': return 'knight-walk';
            case 'attack': return 'knight-attack';
            case 'heavy-attack': return 'knight-heavy-attack';
            case 'victory': return 'knight-victory';
            case 'death': return 'knight-death';
            default: return 'knight-idle';
          }
        };

        return (
          <div
            className={`knight-sprite ${getAnimationClass()}`}
            style={{
              width: `${size}px`,
              height: `${size}px`,
            }}
          />
        );
      };

      // Trigger knight attack animation
      const triggerKnightAttack = (attackType = 'attack') => {
        if (knightActionTimeoutRef.current) {
          clearTimeout(knightActionTimeoutRef.current);
        }
        setKnightAction(attackType);
        knightActionTimeoutRef.current = setTimeout(() => {
          setKnightAction('idle');
        }, attackType === 'heavy-attack' ? 800 : 600);
      };

      // Blood Orb Component (Daily Progress)
      const BloodOrb = ({ percentage }) => (
        <div className="relative w-20 h-20">
          <svg viewBox="0 0 100 100" className="w-full h-full">
            <defs>
              <linearGradient id="bloodGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                <stop offset="0%" stopColor="#8b0000" />
                <stop offset="100%" stopColor="#dc143c" />
              </linearGradient>
              <clipPath id="orbClip">
                <circle cx="50" cy="50" r="45" />
              </clipPath>
            </defs>
            <circle cx="50" cy="50" r="47" fill="none" stroke="#1a1a1a" strokeWidth="4" />
            <circle cx="50" cy="50" r="45" fill="#0a0a0a" />
            <g clipPath="url(#orbClip)">
              <rect x="0" y={100 - percentage} width="100" height={percentage} fill="url(#bloodGradient)" className="fluid-wave" />
            </g>
            <circle cx="50" cy="50" r="45" fill="none" stroke="#3a0a0a" strokeWidth="2" />
          </svg>
          <div className="absolute inset-0 flex items-center justify-center">
            <span className="text-red-400 font-bold text-sm">{Math.round(percentage)}%</span>
          </div>
        </div>
      );

      // Gold Orb Component (Weekly Progress)
      const GoldOrb = ({ percentage }) => (
        <div className="relative w-20 h-20">
          <svg viewBox="0 0 100 100" className="w-full h-full">
            <defs>
              <linearGradient id="goldGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                <stop offset="0%" stopColor="#8b6914" />
                <stop offset="100%" stopColor="#ffd700" />
              </linearGradient>
              <clipPath id="goldClip">
                <circle cx="50" cy="50" r="45" />
              </clipPath>
            </defs>
            <circle cx="50" cy="50" r="47" fill="none" stroke="#1a1a1a" strokeWidth="4" />
            <circle cx="50" cy="50" r="45" fill="#0a0a0a" />
            <g clipPath="url(#goldClip)">
              <rect x="0" y={100 - percentage} width="100" height={percentage} fill="url(#goldGradient)" className="fluid-wave" />
            </g>
            <circle cx="50" cy="50" r="45" fill="none" stroke="#3a2a0a" strokeWidth="2" />
          </svg>
          <div className="absolute inset-0 flex items-center justify-center">
            <span className="text-yellow-400 font-bold text-sm">{Math.round(percentage)}%</span>
          </div>
        </div>
      );

      // Gothic Spire Component
      const GothicSpire = ({ fragments, level, isBoss, isSabbathMode }) => {
        const fragmentElements = [
          { id: 1, path: 'M45 180 L55 180 L55 200 L45 200 Z', y: 180 },
          { id: 2, path: 'M42 155 L58 155 L58 180 L42 180 Z', y: 155 },
          { id: 3, path: 'M40 125 L60 125 L60 155 L40 155 Z', y: 125 },
          { id: 4, path: 'M38 90 L62 90 L62 125 L38 125 Z', y: 90 },
          { id: 5, path: 'M50 20 L65 90 L35 90 Z', y: 20 },
        ];

        return (
          <div className={`relative ${towerShake ? 'screen-shake' : ''}`}>
            <svg viewBox="0 0 100 220" className={`w-32 h-48 ${isSabbathMode ? 'spire-glow' : ''}`}>
              <defs>
                <linearGradient id="spireGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stopColor="#2a2a2a" />
                  <stop offset="100%" stopColor="#0a0a0a" />
                </linearGradient>
                <linearGradient id="activeFragment" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stopColor="#8b0000" />
                  <stop offset="100%" stopColor="#4a0000" />
                </linearGradient>
              </defs>

              {/* Base platform */}
              <rect x="25" y="200" width="50" height="15" fill="#1a1a1a" stroke="#3a3a3a" strokeWidth="1" />

              {/* Tower fragments */}
              {fragmentElements.map((frag, i) => (
                <g key={frag.id}>
                  <path
                    d={frag.path}
                    fill={i < fragments ? 'url(#activeFragment)' : 'url(#spireGradient)'}
                    stroke={i < fragments ? '#dc143c' : '#3a3a3a'}
                    strokeWidth="2"
                    className={lastFragment === i && showCriticalHit ? 'fragment-slam' : ''}
                  />
                  {i < fragments && (
                    <path d={frag.path} fill="none" stroke="#ff4444" strokeWidth="1" opacity="0.5" />
                  )}
                </g>
              ))}

              {/* Level indicator */}
              <text x="50" y="230" textAnchor="middle" fill="#666" fontSize="10" fontFamily="monospace">
                LVL {level}
              </text>
            </svg>

            {/* Boss indicator */}
            {isBoss && (
              <div className="absolute -top-4 left-1/2 transform -translate-x-1/2 text-2xl boss-breath">
                {getBossName().icon}
              </div>
            )}
          </div>
        );
      };

      const today = getTodayString();
      const todayData = weekData[today] || {};
      const progress = ((START_WEIGHT - parseFloat(currentWeight)) / WEIGHT_TO_LOSE) * 100;
      const weeklyStats = getWeeklyStats();
      const lastWeekStats = getLastWeekStats();
      const streak = getStreak();
      const nextWorkout = getNextWorkout();
      const lbsLost = Math.max(0, START_WEIGHT - parseFloat(currentWeight || START_WEIGHT)).toFixed(1);

      const Card = ({ children, className = '', onClick }) => (
        <div onClick={onClick} className={`bg-neutral-900 rounded-xl p-3 sm:p-5 border border-neutral-800 transition-all duration-200 ${onClick ? 'cursor-pointer hover:border-red-700/50' : ''} ${className}`}>
          {children}
        </div>
      );

      return (
        <div className="min-h-screen bg-black text-white p-3 sm:p-4 pb-20 overflow-x-hidden">
          <div className="max-w-lg mx-auto">
            {/* Header */}
            <div className="mb-6 text-center">
              <h1 className="text-4xl font-black tracking-wider text-red-500">AHAB</h1>
            </div>

            {/* Progress Bar */}
            <Card className="mb-5">
              <div className="flex justify-between text-sm mb-2">
                <span className="text-red-400 font-bold">Overall Progress</span>
                <span className="text-red-500 font-bold">{progress.toFixed(1)}%</span>
              </div>
              <div className="w-full bg-neutral-800 rounded-full h-3 overflow-hidden">
                <div className="bg-red-600 h-3 rounded-full transition-all duration-300" style={{ width: `${Math.min(progress, 100)}%` }} />
              </div>
            </Card>

            {/* Navigation - Fixed Bottom on Mobile */}
            <div className="fixed bottom-0 left-0 right-0 bg-black border-t border-red-900/30 px-2 py-1 z-50 safe-area-bottom">
              <div className="max-w-lg mx-auto grid grid-cols-7 gap-0.5">
                {[
                  { id: 'tower', icon: 'ðŸ—¼', label: 'Tower' },
                  { id: 'home', icon: 'ðŸ ', label: 'Home' },
                  { id: 'meals', icon: 'ðŸ½ï¸', label: 'Meals' },
                  { id: 'workouts', icon: 'ðŸ’ª', label: 'Train' },
                  { id: 'power', icon: 'ðŸ†', label: 'PRs' },
                  { id: 'calendar', icon: 'ðŸ“…', label: 'Cal' },
                  { id: 'grocery', icon: 'ðŸ›’', label: 'Shop' }
                ].map(v => (
                  <button key={v.id} onClick={() => setCurrentView(v.id)} className={`flex flex-col items-center py-1.5 rounded-lg transition-all duration-200 ${currentView === v.id ? 'bg-neutral-800 text-red-400' : 'text-neutral-500'}`}>
                    <span className="text-base">{v.icon}</span>
                    <span className="text-[8px] font-medium">{v.label}</span>
                  </button>
                ))}
              </div>
            </div>

            {/* TOWER OF THE DAMNED */}
            {currentView === 'tower' && (
              <div className={`space-y-4 animate-fade-in ${towerShake ? 'screen-shake' : ''}`}>
                {/* Critical Hit Flash Overlay */}
                {showCriticalHit && (
                  <div className="fixed inset-0 pointer-events-none z-40 critical-flash" style={{background: 'radial-gradient(circle, rgba(139,0,0,0.6) 0%, rgba(70,130,180,0.3) 100%)'}} />
                )}

                {/* Boss Defeated Overlay */}
                {bossDefeated && !showLoot && (
                  <div className="fixed inset-0 flex items-center justify-center z-50 bg-black/90">
                    <div className="text-center boss-defeat">
                      <p className="text-6xl mb-4">{getBossName().icon}</p>
                      <p className="text-2xl font-black" style={{color: '#8b0000'}}>{getBossName().name}</p>
                      <p className="text-lg mt-2" style={{color: '#4682b4'}}>VANQUISHED</p>
                    </div>
                  </div>
                )}

                {/* Loot Reveal Overlay */}
                {showLoot && (
                  <div className="fixed inset-0 flex items-center justify-center z-50 bg-black/95" onClick={() => { setShowLoot(false); setBossDefeated(false); }}>
                    <div className="text-center loot-reveal">
                      <p className="text-xs tracking-widest mb-4" style={{color: '#4682b4'}}>LEGENDARY LOOT ACQUIRED</p>
                      <div className="w-24 h-24 mx-auto rounded-full flex items-center justify-center soul-fire" style={{background: 'linear-gradient(135deg, #1a1a2e 0%, #0a0a0f 100%)', border: '3px solid #4682b4'}}>
                        <span className="text-5xl">ðŸ–¤</span>
                      </div>
                      <p className="text-xl font-black mt-4" style={{color: '#ffd700'}}>The Iron Heart</p>
                      <p className="text-xs mt-2 text-neutral-500">Tap to continue</p>
                    </div>
                  </div>
                )}

                {/* Flying Fragment */}
                {flyingFragment && (
                  <div className="fixed z-30 pointer-events-none fragment-fly" style={{left: '50%', top: '40%', marginLeft: '-15px'}}>
                    <div className="w-8 h-10 bg-gradient-to-b from-red-800 to-red-950 border border-red-600" style={{clipPath: 'polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%)'}} />
                  </div>
                )}

                {/* Header */}
                <div className="text-center py-3">
                  <h1 className="text-xl font-black tracking-[0.3em]" style={{color: '#8b0000', textShadow: '0 0 20px rgba(139,0,0,0.5), 0 0 40px rgba(139,0,0,0.3)', fontFamily: 'serif'}}>
                    TOWER OF THE DAMNED
                  </h1>
                  <p className="text-[10px] tracking-[0.2em] mt-1" style={{color: '#4682b4'}}>
                    {isSabbath() ? 'â˜½ SABBATH OF SOULS â˜½' : isBossWeek() ? 'âš”ï¸ SCOURGE ROOM âš”ï¸' : 'â€  FORGE THE SPIRE â€ '}
                  </p>
                </div>

                {/* Knight Champion */}
                <div className="flex justify-center py-2">
                  <div className="relative">
                    <KnightSprite action={knightAction} size={140} />
                    {/* Soul fire effect when attacking */}
                    {knightAction !== 'idle' && (
                      <div className="absolute inset-0 rounded-full soul-fire opacity-30 pointer-events-none" />
                    )}
                  </div>
                </div>

                {/* Tower and Orbs Container */}
                <div className="flex items-center justify-center gap-4 py-2">
                  <div className="text-center">
                    <BloodOrb percentage={(getDailyEdicts(today) / 5) * 100} />
                    <p className="text-[10px] mt-1 tracking-widest" style={{color: '#8b0000'}}>BLOOD</p>
                  </div>
                  <GothicSpire
                    fragments={getWeeklyFragments()}
                    level={getTowerLevel()}
                    isBoss={isBossWeek()}
                    isSabbathMode={isSabbath()}
                  />
                  <div className="text-center">
                    <GoldOrb percentage={(getWeeklyFragments() / 5) * 100} />
                    <p className="text-[10px] mt-1 tracking-widest" style={{color: '#8b6914'}}>ESSENCE</p>
                  </div>
                </div>

                {/* Boss Encounter Card */}
                {isBossWeek() && !bossDefeated && (
                  <div className="relative p-4 rounded-lg boss-breath" style={{background: 'linear-gradient(180deg, #1a0a0a 0%, #0a0505 100%)', border: '2px solid #3a0a0a', boxShadow: '0 0 30px rgba(139,0,0,0.3)'}}>
                    <p className="text-[10px] tracking-[0.3em] text-center mb-2" style={{color: '#4682b4'}}>âš”ï¸ SCOURGE ROOM âš”ï¸</p>
                    <p className="text-lg font-black text-center" style={{color: '#8b0000', textShadow: '0 0 10px rgba(139,0,0,0.5)'}}>
                      {getBossName().icon} {getBossName().name}
                    </p>
                    {/* Boss Health Bar */}
                    <div className="mt-3">
                      <div className="flex justify-between text-[10px] mb-1">
                        <span style={{color: '#666'}}>VITALITY</span>
                        <span style={{color: '#8b0000'}}>{5 - getDailyEdicts(today)}/5</span>
                      </div>
                      <div className="h-3 rounded-full overflow-hidden" style={{background: '#0a0a0a', border: '1px solid #3a0a0a'}}>
                        <div
                          className="h-full transition-all duration-500"
                          style={{
                            width: `${((5 - getDailyEdicts(today)) / 5) * 100}%`,
                            background: 'linear-gradient(90deg, #8b0000 0%, #dc143c 50%, #8b0000 100%)'
                          }}
                        />
                      </div>
                    </div>
                    <p className="text-[10px] text-center mt-2" style={{color: '#666'}}>
                      Purge all edicts to vanquish
                    </p>
                  </div>
                )}

                {/* Scroll of Penance */}
                <div className="scroll-texture burnt-edge rounded-lg p-4 parchment-burn">
                  <h3 className="text-center text-sm tracking-[0.2em] mb-4" style={{color: '#8b0000', fontFamily: 'serif', textShadow: '0 2px 4px rgba(0,0,0,0.5)'}}>
                    â›§ EDICTS OF THE DAMNED â›§
                  </h3>
                  <div className="space-y-2">
                    {[
                      { key: 'meal1', label: 'The First Offering', done: todayData.meal1 },
                      { key: 'meal2', label: 'The Second Tribute', done: todayData.meal2 },
                      { key: 'meal3', label: 'The Final Sacrifice', done: todayData.meal3 },
                      { key: 'training', label: 'The Iron Ritual', done: todayData.training },
                      { key: 'water', label: 'The Cleansing Tide', done: (todayData.water || 0) >= 8 }
                    ].map((edict) => (
                      <div
                        key={edict.key}
                        className={`relative p-3 rounded border transition-all ${slashedEdict === edict.key ? 'jitter' : ''}`}
                        style={{
                          background: edict.done ? 'linear-gradient(90deg, rgba(139,0,0,0.2) 0%, transparent 100%)' : 'rgba(0,0,0,0.3)',
                          borderColor: edict.done ? '#5a1a1a' : '#2a1a0a'
                        }}
                      >
                        <div className="flex items-center justify-between">
                          <span
                            className={`text-sm transition-all ${edict.done ? 'line-through opacity-60' : ''}`}
                            style={{
                              color: edict.done ? '#8b0000' : '#a08060',
                              fontFamily: 'serif',
                              textShadow: edict.done ? 'none' : '0 1px 2px rgba(0,0,0,0.5)'
                            }}
                          >
                            {edict.label}
                          </span>
                          <span style={{color: edict.done ? '#dc143c' : '#3a2a1a', fontSize: '18px'}}>
                            {edict.done ? 'âœ—' : 'â—‹'}
                          </span>
                        </div>
                        {/* Red Slash Effect */}
                        {edict.done && (
                          <div
                            className="absolute left-2 right-2 top-1/2 h-0.5 -translate-y-1/2"
                            style={{background: 'linear-gradient(90deg, transparent, #8b0000, #dc143c, #8b0000, transparent)'}}
                          />
                        )}
                        {/* Blood Drip for incomplete (curse) */}
                        {!edict.done && getDayOfWeek() >= 6 && (
                          <div className="absolute bottom-0 left-1/4 w-1 bg-gradient-to-b from-red-900 to-transparent blood-drip" />
                        )}
                      </div>
                    ))}
                  </div>
                  <p className="text-center text-[10px] mt-4" style={{color: '#5a4a3a', fontFamily: 'serif'}}>
                    "Purge your trials upon the Home altar"
                  </p>
                </div>

                {/* Spire Fragments */}
                <div className="p-3 rounded-lg" style={{background: 'linear-gradient(180deg, #0a0a0a 0%, #050505 100%)', border: '1px solid #1a1a1a'}}>
                  <p className="text-[10px] tracking-[0.2em] text-center mb-3" style={{color: '#8b6914'}}>SPIRE FRAGMENTS</p>
                  <div className="flex justify-center gap-2">
                    {[1, 2, 3, 4, 5].map(n => (
                      <div
                        key={n}
                        className={`w-8 h-12 flex items-center justify-center transition-all ${n <= getWeeklyFragments() ? 'soul-fire' : ''}`}
                        style={{
                          background: n <= getWeeklyFragments()
                            ? 'linear-gradient(180deg, #8b0000 0%, #4a0000 100%)'
                            : 'linear-gradient(180deg, #1a1a1a 0%, #0a0a0a 100%)',
                          border: `1px solid ${n <= getWeeklyFragments() ? '#dc143c' : '#2a2a2a'}`,
                          clipPath: 'polygon(15% 0%, 85% 0%, 100% 100%, 0% 100%)'
                        }}
                      >
                        <span className={`text-[10px] font-bold ${n <= getWeeklyFragments() ? 'text-red-400' : 'text-neutral-700'}`}>
                          {n <= getWeeklyFragments() ? 'â¬§' : n}
                        </span>
                      </div>
                    ))}
                  </div>
                  <p className="text-center text-[10px] mt-2" style={{color: '#666'}}>
                    {getWeeklyFragments() >= 5 ? 'â€  Level Forged â€ ' : `${5 - getWeeklyFragments()} fragments to ascend`}
                  </p>
                </div>

                {/* Stats */}
                <div className="grid grid-cols-3 gap-2">
                  <div className="text-center p-3 rounded-lg" style={{background: '#0a0505', border: '1px solid #2a0a0a'}}>
                    <p className="text-2xl font-black" style={{color: '#dc143c'}}>{streak}</p>
                    <p className="text-[8px] tracking-wider" style={{color: '#666'}}>STREAK</p>
                  </div>
                  <div className="text-center p-3 rounded-lg" style={{background: '#05050a', border: '1px solid #0a0a2a'}}>
                    <p className="text-2xl font-black" style={{color: '#4682b4'}}>{getTowerLevel()}</p>
                    <p className="text-[8px] tracking-wider" style={{color: '#666'}}>LEVEL</p>
                  </div>
                  <div className="text-center p-3 rounded-lg" style={{background: '#0a0a05', border: '1px solid #2a2a0a'}}>
                    <p className="text-2xl font-black" style={{color: '#8b6914'}}>{earnedBadges.length}</p>
                    <p className="text-[8px] tracking-wider" style={{color: '#666'}}>BADGES</p>
                  </div>
                </div>

                {/* Earned Badges */}
                {earnedBadges.length > 0 && (
                  <div className="p-3 rounded-lg" style={{background: '#050505', border: '1px solid #1a1a0a'}}>
                    <p className="text-[10px] tracking-[0.2em] text-center mb-2" style={{color: '#8b6914'}}>LEGENDARY LOOT</p>
                    <div className="flex justify-center gap-3 flex-wrap">
                      {earnedBadges.map((badge, i) => (
                        <div key={i} className="text-center">
                          <div className="w-10 h-10 rounded-full flex items-center justify-center" style={{background: 'linear-gradient(135deg, #1a1a2e 0%, #0a0a0f 100%)', border: '2px solid #4682b4'}}>
                            <span className="text-lg">{badge.icon || 'ðŸ†'}</span>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* HOME */}
            {currentView === 'home' && (
              <div className="space-y-4 animate-fade-in">
                {/* Digital Clock */}
                <div className="text-center py-2">
                  <div className="text-5xl font-bold text-red-500 tracking-wider" style={{fontFamily: 'Orbitron, monospace'}}>
                    <Clock />
                  </div>
                  <div className="mt-2">
                    <p className="text-neutral-400 text-xs font-bold" style={{fontFamily: 'Orbitron, monospace'}}>
                      Days until Sept 1, 2026: <Countdown />
                    </p>
                  </div>
                </div>

                {/* Rank & Streak */}
                <Card>
                  <div className="flex justify-between items-start mb-3">
                    <div>
                      <p className="text-xs font-bold text-neutral-400">Rank Level {getCurrentRank().level}</p>
                      <h2 className="text-2xl font-black text-white flex items-center gap-2">
                        <span className="text-3xl">{getCurrentRank().icon}</span>
                        {getCurrentRank().name}
                      </h2>
                    </div>
                    <div className="text-right">
                      <div className="flex items-center gap-2">
                        <span className="text-3xl">ðŸ”¥</span>
                        <span className="text-4xl font-black text-orange-500">{streak}</span>
                      </div>
                      <p className="text-xs text-neutral-400">Day Streak</p>
                    </div>
                  </div>
                  {/* XP Progress Bar */}
                  <div>
                    <div className="flex justify-between text-xs mb-1">
                      <span className="font-bold text-red-400">{xp} XP</span>
                      {getNextRank() && <span className="text-neutral-400">Next: {getNextRank().name} ({getNextRank().xpRequired} XP)</span>}
                      {!getNextRank() && <span className="text-yellow-500 font-bold">MAX RANK</span>}
                    </div>
                    <div className="w-full bg-neutral-800 rounded-full h-3 overflow-hidden">
                      <div className="bg-red-600 h-3 rounded-full transition-all duration-300" style={{ width: `${getXpProgress()}%` }} />
                    </div>
                  </div>
                </Card>

                {/* Daily Log - Primary Action */}
                <Card>
                  {/* Day Selector - Shows current week's dates */}
                  <div className="flex gap-1 mb-4 overflow-x-auto pb-1">
                    {getCurrentWeekDates().map(dateStr => {
                      const isSelected = (selectedLogDay || today) === dateStr;
                      const isToday = dateStr === today;
                      return (
                        <button
                          key={dateStr}
                          onClick={() => setSelectedLogDay(dateStr === today ? null : dateStr)}
                          className={`flex-shrink-0 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${
                            isSelected
                              ? 'bg-red-600 text-white'
                              : isToday
                                ? 'bg-neutral-800 text-red-400 border border-neutral-700'
                                : 'bg-neutral-900 text-neutral-500'
                          }`}
                        >
                          {getDayName(dateStr)}
                        </button>
                      );
                    })}
                  </div>

                  <div className="flex justify-between items-center mb-4">
                    <h3 className="text-sm font-bold text-red-500">
                      {(selectedLogDay || today) === today ? "Today's Log" : formatDateShort(selectedLogDay)}
                    </h3>
                    {loggedDays[selectedLogDay || today] !== true && (
                      <button onClick={() => logProgress(selectedLogDay || today)} className="bg-green-600 text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-green-500 transition-all active:scale-95">
                        Log Progress
                      </button>
                    )}
                  </div>

                  {/* Weight Input */}
                  {(() => {
                    const editDay = selectedLogDay || today;
                    const editData = weekData[editDay] || {};
                    return (
                      <>
                        <div className="mb-4">
                          <label className="text-red-400 text-sm font-bold mb-2 block">Weight (lbs)</label>
                          <DebouncedInput
                            key={editDay}
                            value={editData.weight}
                            onSave={(val) => saveWeight(editDay, val)}
                            placeholder="Enter weight"
                            inputMode="decimal"
                            pattern="[0-9.]*"
                            className="w-full bg-black border border-red-900/50 rounded-xl px-4 py-3 text-red-400 font-bold placeholder-neutral-600 focus:outline-none focus:border-red-600 transition-colors text-lg"
                          />
                        </div>

                        {/* Meals - Reactor Switches */}
                        <div className="space-y-2 mb-4">
                          <p className="text-red-400 text-xs font-bold mb-2">Meals</p>
                          <ReactorSwitch engaged={editData.meal1} onToggle={() => { toggleMeal(editDay, 'meal1'); if (!editData.meal1 && editDay === today) triggerYum(); }} label="Breakfast" color="red" />
                          <ReactorSwitch engaged={editData.meal2} onToggle={() => { toggleMeal(editDay, 'meal2'); if (!editData.meal2 && editDay === today) triggerYum(); }} label="Lunch" color="red" />
                          <ReactorSwitch engaged={editData.meal3} onToggle={() => { toggleMeal(editDay, 'meal3'); if (!editData.meal3 && editDay === today) triggerYum(); }} label="Dinner" color="red" />
                        </div>

                        {/* Training - Reactor Switch */}
                        <div className="mb-4">
                          <p className="text-orange-400 text-xs font-bold mb-2">Training</p>
                          <ReactorSwitch engaged={editData.training} onToggle={() => toggleMeal(editDay, 'training')} label="Strength Training" color="orange" />
                        </div>

                        {/* Water */}
                        <div>
                          <p className="text-blue-400 text-xs font-bold mb-2">Water ({editData.water || 0}/8 glasses)</p>
                          <div className="flex gap-0.5 sm:gap-1">
                            {[1,2,3,4,5,6,7,8].map(n => (
                              <button key={n} onClick={() => updateWater(editDay, editData.water === n ? 0 : n)} className={`flex-1 h-7 sm:h-8 rounded-md sm:rounded-lg text-[10px] sm:text-xs font-bold transition-all duration-200 ${(editData.water || 0) >= n ? 'bg-blue-600 text-white' : 'bg-neutral-900 text-neutral-500 border border-neutral-800'}`}>{n}</button>
                            ))}
                          </div>
                        </div>
                      </>
                    );
                  })()}
                </Card>

                {/* Weight Progress Graph */}
                <Card>
                  <div className="flex justify-between items-center mb-2">
                    <h3 className="text-sm font-bold text-red-500">Weight Progress</h3>
                    <div className="flex items-center gap-2 text-xs">
                      <span className="text-red-400/70">{START_WEIGHT}</span>
                      <span className="text-neutral-600">â†’</span>
                      <span className="text-green-400/70">{GOAL_WEIGHT}</span>
                      <button
                        onClick={() => {
                          if (confirm('Reset weight history?')) {
                            setWeightHistory([]);
                            localStorage.setItem('weightHistory', JSON.stringify([]));
                            triggerSync(); // Sync the reset to cloud
                          }
                        }}
                        className="ml-2 text-neutral-600 hover:text-red-500 transition-colors"
                      >â†»</button>
                    </div>
                  </div>
                  <WeightGraph history={weightHistory} startWeight={START_WEIGHT} goalWeight={GOAL_WEIGHT} />
                  {weightHistory.length > 0 && (
                    <div className="flex justify-between items-center mt-2 text-xs">
                      <span className="text-neutral-500">{weightHistory.length} {weightHistory.length === 1 ? 'entry' : 'entries'}</span>
                      <span className="text-red-400 font-bold">
                        {weightHistory[weightHistory.length - 1].weight < START_WEIGHT
                          ? `${(START_WEIGHT - weightHistory[weightHistory.length - 1].weight).toFixed(1)} lbs lost`
                          : `${(weightHistory[weightHistory.length - 1].weight - START_WEIGHT).toFixed(1)} lbs gained`}
                      </span>
                    </div>
                  )}
                </Card>

                {/* Weekly Stats Summary */}
                <Card>
                  <h3 className="text-sm font-bold text-red-500 mb-3">This Week</h3>
                  <div className="flex justify-between items-center text-sm">
                    <div>
                      <span className="text-neutral-400">Workouts:</span>
                      <span className="text-red-400 font-bold ml-2">{weeklyStats.workoutsHit}</span>
                    </div>
                    <div>
                      <span className="text-neutral-400">Meals:</span>
                      <span className="text-red-400 font-bold ml-2">{weeklyStats.mealsHit}</span>
                    </div>
                    <div>
                      <span className="text-neutral-400">Water:</span>
                      <span className="text-blue-400 font-bold ml-2">{weeklyStats.waterTotal}</span>
                    </div>
                  </div>
                </Card>

                {/* Sync Button */}
                <button
                  onClick={() => { setShowSyncModal(true); setSyncStatus(''); }}
                  className={`w-full mt-4 py-3 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ${
                    syncCode ? 'bg-neutral-800 border border-neutral-700 text-green-400' : 'bg-neutral-900 border border-neutral-800 text-neutral-500 hover:border-neutral-700 hover:text-neutral-400'
                  }`}
                >
                  {syncCode ? (
                    <>
                      <div className={`w-2 h-2 rounded-full ${isSyncing ? 'bg-yellow-500 animate-pulse' : 'bg-green-500'}`}></div>
                      {isSyncing ? 'Syncing...' : 'Cloud Sync Active'}
                    </>
                  ) : (
                    'ðŸ”„ Set Up Cloud Sync'
                  )}
                </button>

                {/* Sync Modal */}
                {showSyncModal && (
                  <div className="fixed inset-0 bg-black/95 flex items-center justify-center z-50 p-4" onClick={() => setShowSyncModal(false)}>
                    <div className="bg-neutral-900 rounded-xl p-5 max-w-sm w-full border border-neutral-800" onClick={e => e.stopPropagation()}>
                      <div className="flex justify-between items-center mb-4">
                        <h3 className="text-lg font-bold text-red-400">Cloud Sync</h3>
                        <button onClick={() => setShowSyncModal(false)} className="text-neutral-500 hover:text-white text-2xl">Ã—</button>
                      </div>

                      <p className="text-neutral-400 text-xs mb-4">
                        {localStorage.getItem('syncCode')
                          ? 'Your data syncs automatically across all devices using this code.'
                          : 'Enter a unique code (like your name) to sync data across devices. Use the same code on all devices.'}
                      </p>

                      {/* Sync Code Input */}
                      <input
                        type="text"
                        value={syncCode}
                        onChange={(e) => setSyncCode(e.target.value.toLowerCase().replace(/[^a-z0-9]/g, ''))}
                        placeholder="Enter sync code (e.g. amit123)"
                        disabled={!!localStorage.getItem('syncCode')}
                        className="w-full bg-black border border-neutral-700 rounded-lg px-4 py-3 text-red-400 font-medium placeholder-neutral-600 focus:outline-none focus:border-red-600 mb-3 disabled:opacity-50"
                      />

                      {/* Connect/Disconnect Button */}
                      {localStorage.getItem('syncCode') ? (
                        <button
                          onClick={disconnectSync}
                          className="w-full py-3 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-500 transition-all"
                        >
                          Disconnect Sync
                        </button>
                      ) : (
                        <button
                          onClick={connectSync}
                          disabled={!syncCode || isSyncing}
                          className={`w-full py-3 rounded-lg text-sm font-medium transition-all ${syncCode && !isSyncing ? 'bg-green-600 text-white hover:bg-green-500' : 'bg-neutral-800 text-neutral-600 cursor-not-allowed'}`}
                        >
                          {isSyncing ? 'Connecting...' : 'Connect & Sync'}
                        </button>
                      )}

                      {/* Status Message */}
                      {syncStatus && (
                        <p className={`mt-3 text-xs font-bold text-center ${syncStatus.includes('Error') || syncStatus.includes('Disconnected') ? 'text-red-500' : 'text-green-400'}`}>
                          {syncStatus}
                        </p>
                      )}

                      {/* Connected indicator */}
                      {localStorage.getItem('syncCode') && (
                        <div className="mt-4 pt-4 border-t border-neutral-800">
                          <div className="flex items-center justify-center gap-2">
                            <div className={`w-2 h-2 rounded-full ${isSyncing ? 'bg-yellow-500 animate-pulse' : 'bg-green-500'}`}></div>
                            <span className="text-xs text-neutral-400">
                              {isSyncing ? 'Syncing...' : 'Connected & syncing'}
                            </span>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                )}
              </div>
            )}

            {/* MEALS */}
            {currentView === 'meals' && (
              <div className="space-y-4 animate-fade-in relative">
                {showYum && (
                  <div className="fixed inset-0 flex items-center justify-center pointer-events-none z-50">
                    <div className="text-4xl font-black text-green-400" style={{animation: 'yumPop 1s ease-out forwards'}}>Logged!</div>
                  </div>
                )}

                <Card>
                  <div className="flex justify-between items-center">
                    <div>
                      <p className="text-xs text-neutral-400 font-bold">Today's Calories</p>
                      <p className="text-2xl font-black text-white">
                        {(todayData.meal1 ? 700 : 0) + (todayData.meal2 ? 700 : 0) + (todayData.meal3 ? 700 : 0)}
                        <span className="text-neutral-400 text-lg"> / 2100</span>
                      </p>
                    </div>
                    <div className="flex gap-1">
                      {['meal1', 'meal2', 'meal3'].map(m => (
                        <div key={m} className={`w-4 h-4 rounded-full transition-colors duration-200 ${todayData[m] ? 'bg-green-500' : 'bg-neutral-800'}`}></div>
                      ))}
                    </div>
                  </div>
                </Card>

                {MEALS.map((m, idx) => (
                  <Card key={m.id} className={`transition-all duration-200 ${todayData[m.id] ? 'border-green-700/50' : ''}`}>
                    <div className="flex justify-between items-start mb-3">
                      <div className="flex items-center gap-3">
                        <button onClick={() => { toggleMeal(today, m.id); if (!todayData[m.id]) triggerYum(); }} className={`w-8 h-8 rounded-lg flex items-center justify-center font-bold transition-all duration-200 ${todayData[m.id] ? 'bg-green-600 text-white' : 'bg-neutral-800 border border-neutral-700 text-neutral-500'}`}>
                          {todayData[m.id] && 'âœ“'}
                        </button>
                        <div>
                          <h3 className="font-bold text-white">{m.name}</h3>
                          <p className="text-xs text-neutral-400">{m.calories} calories</p>
                        </div>
                      </div>
                    </div>
                    <ul className="space-y-1 mb-3">
                      {m.items.map((it, i) => <li key={i} className="text-neutral-300 text-sm flex items-center gap-2"><span className="w-1.5 h-1.5 bg-red-600 rounded-full"></span>{it}</li>)}
                    </ul>
                    <p className="text-xs text-neutral-400">{m.macros}</p>
                  </Card>
                ))}

                <Card>
                  <p className="text-sm font-bold text-red-500 mb-3">Daily Macro Totals</p>
                  <div className="grid grid-cols-3 gap-3">
                    <div className="text-center p-3 bg-neutral-800 rounded-lg border border-neutral-700">
                      <p className="text-xl font-bold text-red-400">200g</p>
                      <p className="text-xs text-neutral-400 font-medium">Protein</p>
                    </div>
                    <div className="text-center p-3 bg-neutral-800 rounded-lg border border-neutral-700">
                      <p className="text-xl font-bold text-orange-400">180g</p>
                      <p className="text-xs text-neutral-400 font-medium">Carbs</p>
                    </div>
                    <div className="text-center p-3 bg-neutral-800 rounded-lg border border-neutral-700">
                      <p className="text-xl font-bold text-yellow-400">60g</p>
                      <p className="text-xs text-neutral-400 font-medium">Fat</p>
                    </div>
                  </div>
                </Card>
              </div>
            )}

            {/* WORKOUTS */}
            {currentView === 'workouts' && (
              <div className="space-y-4 animate-fade-in">
                {/* Sub-navigation: Push/Pull/Legs */}
                <div className="flex gap-1 mb-2 bg-neutral-900 p-1 rounded-lg">
                  {Object.keys(WORKOUTS).map(w => (
                    <button key={w} onClick={() => setSelectedWorkout(w)} className={`flex-1 py-2 rounded-md text-xs font-medium transition-all duration-200 ${selectedWorkout === w ? 'bg-red-600 text-white' : 'text-neutral-400 hover:text-white hover:bg-neutral-800'}`}>{WORKOUTS[w].name}</button>
                  ))}
                </div>
                <input type="date" value={workoutDate} onChange={(e) => setWorkoutDate(e.target.value)} className="w-full bg-neutral-900 border border-neutral-800 rounded-lg px-4 py-2 text-red-400 font-medium focus:outline-none focus:border-red-600" />

                <Card>
                  <h2 className="text-xl font-bold text-red-400 mb-4">{WORKOUTS[selectedWorkout].name} Day</h2>
                  <div className="space-y-3 sm:space-y-4">
                    {WORKOUTS[selectedWorkout].exercises.map((ex, i) => {
                      const exData = getExerciseData(workoutDate, selectedWorkout, ex.name);
                      const history = getWorkoutHistory(selectedWorkout, ex.name);
                      return (
                        <div key={i} className="p-3 sm:p-4 bg-neutral-800 rounded-lg border border-neutral-700">
                          <div className="flex items-center justify-between mb-2 sm:mb-3">
                            <div className="flex items-center gap-2 sm:gap-3">
                              <span className="w-6 h-6 sm:w-7 sm:h-7 bg-red-600 text-white rounded-lg flex items-center justify-center text-xs sm:text-sm font-bold">{i + 1}</span>
                              <span className="font-medium text-white text-sm sm:text-base">{ex.name}</span>
                            </div>
                            <span className="text-xs text-neutral-400 bg-neutral-900 px-2 py-1 rounded">{ex.target}</span>
                          </div>
                          <div className="grid grid-cols-3 gap-1.5 sm:gap-2 mb-2">
                            {['weight', 'sets', 'reps'].map(field => (
                              <div key={field}>
                                <label className="text-[10px] sm:text-xs text-neutral-400 font-medium capitalize">{field}</label>
                                <DebouncedInput
                                  value={exData[field]}
                                  onSave={(val) => updateExerciseLog(workoutDate, selectedWorkout, ex.name, field, val)}
                                  placeholder={field === 'weight' ? 'lbs' : '#'}
                                  inputMode="numeric"
                                  className="w-full bg-black border border-neutral-700 rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 text-red-400 font-medium text-sm focus:outline-none focus:border-red-600"
                                />
                              </div>
                            ))}
                          </div>
                          {history.length > 0 && (
                            <div className="flex flex-wrap gap-1 mt-2">
                              {history.map((h, hi) => (
                                <span key={hi} className="text-xs bg-red-950/50 text-red-400 rounded-lg px-2 py-1">{h.date.slice(5)}: {h.weight}Ã—{h.sets}Ã—{h.reps}</span>
                              ))}
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                </Card>

                {/* Cardio */}
                <Card>
                  <h2 className="text-lg font-bold text-blue-400 mb-2">Cardio</h2>
                  <p className="text-neutral-400 text-xs mb-4">Goal: 60 minutes daily</p>
                  <div className="space-y-2">
                    <ReactorSwitch
                      engaged={todayData.cardio1}
                      onToggle={() => toggleMeal(today, 'cardio1')}
                      label="Session 1: 30 min"
                      color="blue"
                    />
                    <ReactorSwitch
                      engaged={todayData.cardio2}
                      onToggle={() => toggleMeal(today, 'cardio2')}
                      label="Session 2: 30 min"
                      color="blue"
                    />
                  </div>
                  <div className="mt-3 flex items-center gap-2">
                    <div className="flex-1 h-2 bg-neutral-800 rounded-full overflow-hidden">
                      <div className="h-2 bg-blue-600 rounded-full transition-all" style={{ width: `${((todayData.cardio1 ? 1 : 0) + (todayData.cardio2 ? 1 : 0)) * 50}%` }} />
                    </div>
                    <span className="text-blue-400 text-xs font-medium">{(todayData.cardio1 ? 30 : 0) + (todayData.cardio2 ? 30 : 0)}/60 min</span>
                  </div>
                </Card>
              </div>
            )}

            {/* Personal Records */}
            {currentView === 'power' && (
              <div className="space-y-4 animate-fade-in">
                <Card>
                  <h2 className="text-xl font-bold text-yellow-400 flex items-center gap-2 mb-2">
                    ðŸ† Personal Records
                  </h2>
                  <p className="text-neutral-400 text-xs">Your best lifts, automatically tracked from workouts</p>
                </Card>

                {Object.keys(WORKOUTS).map(workoutType => (
                  <Card key={workoutType}>
                    <h3 className="font-bold text-lg mb-3" style={{color: workoutType === 'push' ? '#f87171' : workoutType === 'pull' ? '#60a5fa' : '#a78bfa'}}>
                      {WORKOUTS[workoutType].name} Day
                    </h3>
                    <div className="space-y-3">
                      {WORKOUTS[workoutType].exercises.map(ex => {
                        const pr = getExercisePR(workoutType, ex.name);
                        return (
                          <div key={ex.name} className="flex items-center justify-between py-2 border-b border-neutral-800 last:border-0">
                            <span className="text-neutral-300 text-sm">{ex.name}</span>
                            {pr ? (
                              <div className="text-right">
                                <span className="text-yellow-400 font-bold">{pr.weight} lbs</span>
                                {pr.reps && <span className="text-neutral-500 text-sm"> Ã— {pr.reps}</span>}
                                <p className="text-neutral-600 text-xs">{pr.date}</p>
                              </div>
                            ) : (
                              <span className="text-neutral-600 text-sm italic">No data yet</span>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </Card>
                ))}
              </div>
            )}

            {/* Calendar */}
            {currentView === 'calendar' && (
              <div className="space-y-4 animate-fade-in">
                <Card>
                  <div className="flex justify-between items-center mb-4">
                    <button onClick={() => setCalendarMonth(new Date(calendarMonth.getFullYear(), calendarMonth.getMonth() - 1))} className="text-red-500 font-bold text-xl px-3 py-1 hover:bg-neutral-800 rounded-lg transition-colors">â†</button>
                    <h2 className="text-lg font-bold text-red-400">
                      {calendarMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
                    </h2>
                    <button onClick={() => setCalendarMonth(new Date(calendarMonth.getFullYear(), calendarMonth.getMonth() + 1))} className="text-red-500 font-bold text-xl px-3 py-1 hover:bg-neutral-800 rounded-lg transition-colors">â†’</button>
                  </div>

                  {/* Day headers */}
                  <div className="grid grid-cols-7 gap-1 mb-2">
                    {['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((d, i) => (
                      <div key={i} className="text-center text-xs font-bold text-red-600">{d}</div>
                    ))}
                  </div>

                  {/* Calendar grid */}
                  <div className="grid grid-cols-7 gap-1">
                    {getCalendarDays().map((day, i) => {
                      const status = getDayStatus(day);
                      const statusColors = {
                        empty: 'bg-transparent',
                        future: 'bg-neutral-900 text-neutral-700',
                        perfect: 'bg-yellow-500 text-black',
                        partial: 'bg-red-600 text-white',
                        missed: 'bg-neutral-800 text-neutral-500 border border-neutral-700'
                      };
                      return (
                        <div
                          key={i}
                          className={`aspect-square flex items-center justify-center rounded-lg text-xs font-bold cursor-pointer active:scale-95 transition-transform ${statusColors[status]}`}
                          onTouchStart={() => {
                            if (day && status !== 'future') {
                              const timer = setTimeout(() => setCalendarDayDetail(day), 500);
                              setLongPressTimer(timer);
                            }
                          }}
                          onTouchEnd={() => { if (longPressTimer) clearTimeout(longPressTimer); }}
                          onMouseDown={() => {
                            if (day && status !== 'future') {
                              const timer = setTimeout(() => setCalendarDayDetail(day), 500);
                              setLongPressTimer(timer);
                            }
                          }}
                          onMouseUp={() => { if (longPressTimer) clearTimeout(longPressTimer); }}
                          onMouseLeave={() => { if (longPressTimer) clearTimeout(longPressTimer); }}
                        >
                          {day}
                        </div>
                      );
                    })}
                  </div>

                  {/* Day Detail Modal */}
                  {calendarDayDetail && (
                    <div className="fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4" onClick={() => setCalendarDayDetail(null)}>
                      <div className="bg-neutral-900 rounded-xl p-6 max-w-sm w-full border border-neutral-800" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-4">
                          <h3 className="text-lg font-bold text-red-400">
                            {calendarMonth.toLocaleDateString('en-US', { month: 'short' })} {calendarDayDetail}
                          </h3>
                          <button onClick={() => setCalendarDayDetail(null)} className="text-neutral-500 hover:text-white text-xl">Ã—</button>
                        </div>
                        {(() => {
                          const dateObj = new Date(calendarMonth.getFullYear(), calendarMonth.getMonth(), calendarDayDetail);
                          const dateStr = dateObj.toISOString().split('T')[0];
                          const data = weekData[dateStr] || {};
                          return (
                            <div className="space-y-3">
                              <div className="flex justify-between items-center">
                                <span className="text-neutral-400 text-sm">Weight</span>
                                <span className="text-white font-bold">{data.weight || 'â€”'} LBS</span>
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-neutral-400 text-sm">Meals</span>
                                <div className="flex gap-1">
                                  {['meal1', 'meal2', 'meal3'].map((m, idx) => (
                                    <div key={m} className={`w-6 h-6 rounded flex items-center justify-center text-xs font-bold ${data[m] ? 'bg-red-600 text-white' : 'bg-neutral-800 text-neutral-600'}`}>
                                      {data[m] ? 'âœ“' : idx + 1}
                                    </div>
                                  ))}
                                </div>
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-neutral-400 text-sm">Training</span>
                                <span className={`font-bold ${data.training ? 'text-green-400' : 'text-neutral-600'}`}>{data.training ? 'COMPLETE' : 'SKIPPED'}</span>
                              </div>
                              <div className="flex justify-between items-center">
                                <span className="text-neutral-400 text-sm">Water</span>
                                <span className="text-blue-400 font-bold">{data.water || 0}/8 glasses</span>
                              </div>
                            </div>
                          );
                        })()}
                      </div>
                    </div>
                  )}
                </Card>

                {/* Legend */}
                <Card>
                  <h3 className="text-sm font-bold text-red-500 mb-3">Legend</h3>
                  <div className="grid grid-cols-2 gap-2">
                    <div className="flex items-center gap-2">
                      <div className="w-4 h-4 rounded bg-yellow-500"></div>
                      <span className="text-xs text-neutral-300 font-medium">Perfect Day</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className="w-4 h-4 rounded bg-red-600"></div>
                      <span className="text-xs text-neutral-300 font-medium">Partial</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className="w-4 h-4 rounded bg-neutral-800 border border-neutral-700"></div>
                      <span className="text-xs text-neutral-300 font-medium">Missed</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className="w-4 h-4 rounded bg-neutral-900"></div>
                      <span className="text-xs text-neutral-300 font-medium">Future</span>
                    </div>
                  </div>
                </Card>
              </div>
            )}

            {/* Grocery List */}
            {currentView === 'grocery' && (
              <div className="space-y-4 animate-fade-in">
                <Card>
                  <h2 className="font-bold text-orange-400 mb-3">Bulk Staples</h2>
                  <div className="space-y-2">
                    {GROCERY_BULK.map(it => (
                      <button key={it} onClick={() => toggleGrocery(it)} className={`w-full flex items-center gap-3 p-3 rounded-lg transition-all duration-200 ${groceryChecked[it] ? 'bg-neutral-800 border border-neutral-700' : 'bg-neutral-900 border border-neutral-800'}`}>
                        <div className={`w-6 h-6 rounded-lg flex items-center justify-center font-bold transition-colors ${groceryChecked[it] ? 'bg-green-600 text-white' : 'bg-neutral-800 border border-neutral-700'}`}>
                          {groceryChecked[it] && 'âœ“'}
                        </div>
                        <span className={`text-sm font-medium transition-all ${groceryChecked[it] ? 'text-neutral-500 line-through' : 'text-neutral-200'}`}>{it}</span>
                      </button>
                    ))}
                  </div>
                </Card>

                <Card>
                  <h2 className="font-bold text-red-400 mb-3">Weekly Fresh</h2>
                  <div className="space-y-2">
                    {GROCERY_WEEKLY.map(it => (
                      <button key={it} onClick={() => toggleGrocery(it)} className={`w-full flex items-center gap-3 p-3 rounded-lg transition-all duration-200 ${groceryChecked[it] ? 'bg-neutral-800 border border-neutral-700' : 'bg-neutral-900 border border-neutral-800'}`}>
                        <div className={`w-6 h-6 rounded-lg flex items-center justify-center font-bold transition-colors ${groceryChecked[it] ? 'bg-green-600 text-white' : 'bg-neutral-800 border border-neutral-700'}`}>
                          {groceryChecked[it] && 'âœ“'}
                        </div>
                        <span className={`text-sm font-medium transition-all ${groceryChecked[it] ? 'text-neutral-500 line-through' : 'text-neutral-200'}`}>{it}</span>
                      </button>
                    ))}
                  </div>
                </Card>
              </div>
            )}

          </div>

          {/* Logged Confirmation Popup */}
          {showLogged && (
            <div className="fixed inset-0 flex items-center justify-center pointer-events-none z-50">
              <div className="text-3xl font-bold text-green-400" style={{animation: 'yumPop 1.5s ease-out forwards'}}>Logged! âœ“</div>
            </div>
          )}

        </div>
      );
    };

    ReactDOM.render(<AhabApp />, document.getElementById('root'));
  </script>
</body>
</html>
